<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ZITRONTCHIK | ARENA ULTIMATE</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #0f0; text-align: center; margin: 0; user-select: none; overflow: hidden; }
        
        /* –õ–û–ë–ë–ò */
        #lobby { padding: 40px; display: block; }
        .weapon-select { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 20px; }
        .weapon-btn { background: #111; border: 2px solid #0f0; border-radius: 12px; padding: 15px; cursor: pointer; transition: 0.3s; width: 140px; }
        .weapon-btn:hover { background: #0f0; transform: scale(1.05); color: #000; }
        .weapon-btn span { font-size: 40px; display: block; }
        .weapon-btn p { font-size: 11px; color: #aaa; }

        /* –ê–†–ï–ù–ê */
        #arena { background: #0a0a0a; border: 4px solid #f00; width: 100%; height: 450px; position: relative; overflow: hidden; margin: 10px auto; max-width: 900px; display: none; }
        
        /* –ò–ì–†–û–ö–ò */
        .player { position: absolute; width: 40px; height: 40px; border-radius: 8px; background: #0f0; transition: top 0.1s linear, left 0.1s linear; }
        .player.me { background: #00f; border: 2px solid #fff; box-shadow: 0 0 15px #00f; z-index: 10; }
        .player.invul { filter: brightness(2) drop-shadow(0 0 10px #fff); }
        .player.stun { opacity: 0.5; filter: grayscale(1); }

        .weapon-img { position: absolute; font-size: 24px; pointer-events: none; transition: 0.1s; }
        .attacking { animation: strike 0.2s; }
        @keyframes strike { 0% { transform: scale(1); } 50% { transform: scale(2) rotate(-20deg); } 100% { transform: scale(1); } }

        /* UI */
        .hp-bar { width: 40px; height: 6px; background: #333; position: absolute; top: -12px; border: 1px solid #000; }
        .hp-fill { height: 100%; background: #0f0; }
        .name-tag { font-size: 10px; position: absolute; top: -26px; width: 100px; left: -30px; color: #fff; }
        
        #ability-hud { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: none; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 20px; border: 1px solid #0f0; }
        #cd-box { width: 100px; height: 10px; background: #222; margin-left: 10px; border-radius: 5px; overflow: hidden; display: inline-block; }
        #cd-fill { height: 100%; width: 0%; background: #0f0; }
    </style>
</head>
<body>

    <div id="lobby">
        <h1 style="text-shadow: 0 0 10px #0f0;">üçã ZITRON ARENA ‚öîÔ∏è</h1>
        <h3>–í–´–ë–ï–†–ò –û–†–£–ñ–ò–ï –î–õ–Ø –ë–û–Ø:</h3>
        <div class="weapon-select">
            <div class="weapon-btn" onclick="join('üó°Ô∏è', 'dash')"><span>üó°Ô∏è</span><b>–ú–ï–ß</b><p>F: –†—ã–≤–æ–∫ –≤–ø–µ—Ä–µ–¥</p></div>
            <div class="weapon-btn" onclick="join('üçã', 'shoot')"><span>üçã</span><b>–õ–ò–ú–û–ù</b><p>F: –î–∞–ª—å–Ω–∏–π –≤—ã—Å—Ç—Ä–µ–ª</p></div>
            <div class="weapon-btn" onclick="join('ü•ñ', 'shield')"><span>ü•ñ</span><b>–ë–ê–ì–ï–¢</b><p>F: –©–∏—Ç (3 —Å–µ–∫)</p></div>
            <div class="weapon-btn" onclick="join('üé∏', 'wave')"><span>üé∏</span><b>–ì–ò–¢–ê–†–ê</b><p>F: –ó–≤—É–∫–æ–≤–æ–π —É–¥–∞—Ä</p></div>
        </div>
    </div>

    <div id="arena" onmousedown="attack()"></div>
    
    <div id="ability-hud">
        <span id="cur-wpn"></span> [F] <div id="cd-box"><div id="cd-fill"></div></div>
    </div>

<script>
    const config = {
        databaseURL: "https://zitron-blog-default-rtdb.firebaseio.com",
        projectId: "zitron-blog"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myId = "User_" + Math.floor(Math.random()*999);
    let state = { x: 200, y: 350, vy: 0, hp: 100, wpn: 'üó°Ô∏è', type: '', atk: false, inv: false, stun: false, cd: 0 };
    let keys = {};
    let active = false;

    function join(emoji, type) {
        state.wpn = emoji; state.type = type;
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('arena').style.display = 'block';
        document.getElementById('ability-hud').style.display = 'block';
        document.getElementById('cur-wpn').innerText = emoji;
        active = true;
        db.ref('players/' + myId).set(state);
        db.ref('players/' + myId).onDisconnect().remove();
    }

    window.onkeydown = e => { 
        keys[e.code] = true; 
        if(e.code === 'KeyF' && state.cd <= 0) useAbility();
    };
    window.onkeyup = e => keys[e.code] = false;

    // –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ
    setInterval(() => {
        if(!active || state.stun) return;

        if(keys['KeyA']) state.x -= 7;
        if(keys['KeyD']) state.x += 7;
        if(keys['Space'] && state.y >= 350) state.vy = -15;

        state.vy += 0.8; state.y += state.vy;
        if(state.y > 350) { state.y = 350; state.vy = 0; }
        if(state.x < 0) state.x = 0; if(state.x > 850) state.x = 850;

        if(state.cd > 0) {
            state.cd -= 50;
            document.getElementById('cd-fill').style.width = (state.cd / 3000 * 100) + "%";
        }

        db.ref('players/' + myId).update({ x: state.x, y: state.y, hp: state.hp, atk: state.atk, inv: state.inv, stun: state.stun });
    }, 50);

    function attack() {
        if(!active || state.atk) return;
        state.atk = true;
        
        db.ref('players').once('value', s => {
            let all = s.val();
            for(let id in all) {
                if(id !== myId) {
                    let enemy = all[id];
                    let d = Math.hypot(state.x - enemy.x, state.y - enemy.y);
                    if(d < 70 && !enemy.inv) {
                        db.ref('players/' + id + '/hp').transaction(h => (h || 100) - 10);
                    }
                }
            }
        });
        setTimeout(() => { state.atk = false; }, 200);
    }

    function useAbility() {
        state.cd = 3000;
        if(state.type === 'dash') {
            state.x += (keys['KeyA'] ? -150 : 150);
        } else if(state.type === 'shield') {
            state.inv = true; setTimeout(() => state.inv = false, 2000);
        } else if(state.type === 'shoot' || state.type === 'wave') {
            db.ref('players').once('value', s => {
                let all = s.val();
                for(let id in all) {
                    if(id !== myId) {
                        let enemy = all[id];
                        let d = Math.hypot(state.x - enemy.x, state.y - enemy.y);
                        if(d < 200 && !enemy.inv) db.ref('players/' + id + '/hp').transaction(h => h - 20);
                    }
                }
            });
        }
    }

    db.ref('players').on('value', s => {
        if(!active) return;
        const arena = document.getElementById('arena');
        arena.innerHTML = '';
        let all = s.val();
        for(let id in all) {
            let d = all[id];
            if(id === myId) state.hp = d.hp;
            
            let pDiv = document.createElement('div');
            pDiv.className = `player ${id===myId?'me':''} ${d.inv?'inv':''} ${d.stun?'stun':''}`;
            pDiv.style.left = d.x + 'px'; pDiv.style.top = d.y + 'px';
            pDiv.innerHTML = `<div class="hp-bar"><div class="hp-fill" style="width:${d.hp}%"></div></div><div class="name-tag">${id}</div>`;
            
            let wDiv = document.createElement('div');
            wDiv.className = `weapon-img ${d.atk?'attacking':''}`;
            wDiv.innerText = d.wpn;
            wDiv.style.left = (d.x + 35) + 'px'; wDiv.style.top = (d.y + 5) + 'px';
            
            arena.appendChild(pDiv); arena.appendChild(wDiv);

            if(state.hp <= 0) { alert("GG! –¢–´ –ü–†–û–ò–ì–†–ê–õ"); location.reload(); }
        }
    });
</script>
</body>
</html>
