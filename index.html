<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ZITRONTCHIK | ARENA</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #000; color: #0f0; text-align: center; margin: 0; }
        #arena { background: #111; border: 3px solid #f00; width: 100%; height: 400px; position: relative; overflow: hidden; margin: 20px auto; max-width: 800px; }
        .player { position: absolute; width: 40px; height: 40px; border-radius: 5px; background: #0f0; transition: 0.1s; }
        .player.me { background: #00f; border: 2px solid #fff; box-shadow: 0 0 15px #00f; z-index: 10; }
        .hp { width: 40px; height: 5px; background: #333; position: absolute; top: -10px; }
        .hp-fill { height: 100%; background: #0f0; }
        .name { font-size: 10px; position: absolute; top: -25px; width: 100px; left: -30px; color: #fff; }
        .btn { background: #0f0; color: #000; padding: 20px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 20px; margin: 20px; }
    </style>
</head>
<body>
    <h1>ZITRONTCHIK ARENA</h1>
    <div id="arena" onclick="hit(event)"></div>
    <button class="btn" onclick="start()">ВОЙТИ В БОЙ</button>

<script>
    // ТВОЙ КОНФИГ (Настроен под скриншот №7)
    const config = {
        databaseURL: "https://zitron-blog-default-rtdb.firebaseio.com",
        projectId: "zitron-blog"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    let id = "Zitron_" + Math.floor(Math.random()*99);
    let p = { x: 100, y: 350, vy: 0, hp: 100 };
    let keys = {};

    function start() {
        db.ref('players/' + id).set(p);
        db.ref('players/' + id).onDisconnect().remove();
        console.log("Игрок создан в базе!");
    }

    window.onkeydown = (e) => keys[e.code] = true;
    window.onkeyup = (e) => keys[e.code] = false;

    // Игровой цикл
    setInterval(() => {
        if (keys['KeyA']) p.x -= 7;
        if (keys['KeyD']) p.x += 7;
        if (keys['Space'] && p.y >= 350) p.vy = -15;
        
        p.vy += 0.8; 
        p.y += p.vy;

        if (p.y > 350) { p.y = 350; p.vy = 0; }
        if (p.x < 0) p.x = 0;
        if (p.x > 760) p.x = 760;

        // Отправляем координаты в Firebase только если мы в игре
        db.ref('players/' + id).update({ x: p.x, y: p.y, hp: p.hp });
    }, 30);

    // Отрисовка всех игроков
    db.ref('players').on('value', (s) => {
        const arena = document.getElementById('arena');
        arena.querySelectorAll('.player').forEach(el => el.remove());
        const data = s.val();
        if(!data) return;

        for(let name in data) {
            const d = data[name];
            const div = document.createElement('div');
            div.className = 'player' + (name === id ? ' me' : '');
            div.style.left = d.x + 'px'; 
            div.style.top = d.y + 'px';
            div.innerHTML = `
                <div class="hp"><div class="hp-fill" style="width:${d.hp}%"></div></div>
                <div class="name">${name}</div>
            `;
            arena.appendChild(div);
        }
    });

    // Функция атаки
    function hit(e) {
        db.ref('players').once('value', (s) => {
            const data = s.val();
            for(let name in data) {
                if(name !== id) {
                    const target = data[name];
                    const dist = Math.hypot(e.offsetX - (target.x+20), e.offsetY - (target.y+20));
                    if(dist < 50) {
                        db.ref('players/' + name + '/hp').transaction(h => (h || 100) - 10);
                    }
                }
            }
        });
    }
</script>
</body>
</html>
